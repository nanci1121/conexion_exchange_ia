<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email AI - Dashboard de Control</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>

<body class="dark-theme">
    <div class="glass-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon"></div>
                <h1>Email<span>AI</span></h1>
            </div>
            <nav>
                <a href="#" class="active"><i class="icon-dashboard"></i> Dashboard</a>
                <a href="#"><i class="icon-mail"></i> Correos</a>
                <a href="#"><i class="icon-brain"></i> Conocimiento</a>
                <a href="#"><i class="icon-settings"></i> Ajustes</a>
            </nav>
            <div class="status-badge">
                <div class="pulse-indicator" id="main-status-dot"></div>
                <span id="main-status-text">Sistema Activo</span>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <header>
                <div class="header-info">
                    <h2>Panel de Control</h2>
                    <p>Monitorizaci√≥n en tiempo real del asistente inteligente.</p>
                </div>
                <div class="user-profile">
                    <span class="v-avatar" id="user-avatar">?</span>
                    <span class="username" id="user-name">Usuario</span>
                </div>
            </header>

            <!-- Stats Grid -->
            <section class="stats-grid">
                <div class="stat-card glass">
                    <div class="stat-icon blue">üì¨</div>
                    <div class="stat-data">
                        <h3 id="stat-emails">0</h3>
                        <p>Correos Procesados</p>
                    </div>
                </div>
                <div class="stat-card glass">
                    <div class="stat-icon purple">üß†</div>
                    <div class="stat-data">
                        <h3 id="stat-llm">Activo</h3>
                        <p>Estado LLM (Llama 3.2 3B)</p>
                    </div>
                </div>
                <div class="stat-card glass">
                    <div class="stat-icon green">‚ö°</div>
                    <div class="stat-data">
                        <h3 id="stat-latency">-- ms</h3>
                        <p>Latencia Media</p>
                    </div>
                </div>
                <div class="stat-card glass">
                    <div class="stat-icon orange">üîã</div>
                    <div class="stat-data">
                        <h3 id="stat-exchange">Conectado</h3>
                        <p>Exchange (HUAYI)</p>
                    </div>
                </div>
            </section>

            <!-- Active Focus Section -->
            <section id="focus-section" class="glass"
                style="display: none; margin-bottom: 30px; padding: 20px; border-left: 4px solid var(--accent-purple); animation: slideIn 0.5s ease-out;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <span class="status-label warning"
                            style="margin-bottom: 10px; display: inline-block;">PROCESANDO AHORA</span>
                        <h3 id="focus-subject" style="font-size: 20px; margin-bottom: 5px;">-</h3>
                        <p id="focus-sender" style="color: var(--text-dim); font-size: 14px;">-</p>
                    </div>
                    <div class="processing-loader"></div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings-section" class="glass" style="display: none; padding: 30px; border-radius: 20px;">
                <div class="section-header">
                    <h3>Ajustes del Sistema</h3>
                </div>
                <div class="settings-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div class="settings-group">
                        <h4 style="color: var(--accent-blue); margin-bottom: 20px;">Conexi√≥n Exchange</h4>
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label
                                style="display: block; color: var(--text-dim); font-size: 13px; margin-bottom: 8px;">Usuario
                                (Email)</label>
                            <input type="text" id="setting-ex-user" class="glass-input" style="width: 100%;">
                        </div>
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label
                                style="display: block; color: var(--text-dim); font-size: 13px; margin-bottom: 8px;">Servidor
                                de Exchange</label>
                            <input type="text" id="setting-ex-server" class="glass-input" style="width: 100%;"
                                placeholder="p.ej: mail.huayicompressor.es">
                        </div>
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label
                                style="display: block; color: var(--text-dim); font-size: 13px; margin-bottom: 8px;">Usuario
                                de Inicio (UPN) - Opcional</label>
                            <input type="text" id="setting-ex-upn" class="glass-input" style="width: 100%;"
                                placeholder="p.ej: DOMAIN\usuario">
                        </div>
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label
                                style="display: block; color: var(--text-dim); font-size: 13px; margin-bottom: 8px;">Contrase√±a</label>
                            <div class="password-wrapper">
                                <input type="password" id="setting-ex-pass" class="glass-input"
                                    style="width: 100%; padding-right: 40px;" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                <span class="toggle-password" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
                            </div>
                        </div>
                    </div>
                    <script>
                        function togglePasswordVisibility() {
                            const passInput = document.getElementById('setting-ex-pass');
                            const toggleIcon = document.querySelector('.toggle-password');
                            if (passInput.type === 'password') {
                                passInput.type = 'text';
                                toggleIcon.innerText = 'üôà';
                            } else {
                                passInput.type = 'password';
                                toggleIcon.innerText = 'üëÅÔ∏è';
                            }
                        }
                    </script>
                    <div class="settings-group">
                        <h4 style="color: var(--accent-purple); margin-bottom: 20px;">Par√°metros de IA</h4>
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label
                                style="display: block; color: var(--text-dim); font-size: 13px; margin-bottom: 8px;">Modelo
                                Activo</label>
                            <input type="text" value="Llama 3.2 3B (GGUF Q4)" class="glass-input" style="width: 100%;"
                                readonly>
                        </div>
                        <div class="form-group" style="display: flex; gap: 15px;">
                            <div style="flex: 1;">
                                <label
                                    style="display: block; color: var(--text-dim); font-size: 13px; margin-bottom: 8px;">CPU
                                    Threads</label>
                                <input type="number" id="setting-ai-threads" class="glass-input" style="width: 100%;">
                            </div>
                            <div style="flex: 1;">
                                <label
                                    style="display: block; color: var(--text-dim); font-size: 13px; margin-bottom: 8px;">Temperatura</label>
                                <input type="number" step="0.1" id="setting-ai-temp" class="glass-input"
                                    style="width: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
                <div
                    style="margin-top: 30px; border-top: 1px solid var(--glass-border); padding-top: 20px; display: flex; justify-content: flex-end;">
                    <button class="btn btn-primary" onclick="handleSaveConfig()">Guardar Cambios</button>
                </div>
            </section>

            <!-- Knowledge Section -->
            <section id="knowledge-section" class="glass" style="display: none; padding: 30px; border-radius: 20px;">
                <div class="section-header">
                    <h3>Base de Conocimiento (RAG)</h3>
                </div>
                <div class="upload-area"
                    style="border: 2px dashed var(--glass-border); padding: 40px; text-align: center; border-radius: 16px; margin-bottom: 30px;">
                    <div class="upload-area" id="drop-zone" onclick="document.getElementById('file-input').click()">
                        <div class="upload-icon">üìÑ</div>
                        <p>Arrastra tus documentos aqu√≠ o <span style="color: var(--accent-blue); cursor: pointer;">haz
                                clic para buscar</span></p>
                        <span style="font-size: 12px; color: var(--text-dim);">Soportado: PDF, DOCX, TXT (M√°x
                            10MB)</span>
                        <input type="file" id="file-input" style="display: none;" accept=".pdf,.docx,.txt"
                            onchange="handleFileUpload(this.files[0])">
                    </div>

                    <div class="knowledge-list" style="margin-top: 30px;">
                        <h4 style="margin-bottom: 20px;">Documentos Indexados</h4>
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="text-align: left; border-bottom: 1px solid var(--glass-border);">
                                    <th style="padding: 10px; color: var(--text-dim); font-size: 13px;">Nombre</th>
                                    <th style="padding: 10px; color: var(--text-dim); font-size: 13px;">Fecha</th>
                                    <th style="padding: 10px; color: var(--text-dim); font-size: 13px;">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="knowledge-body">
                                <tr>
                                    <td colspan="3" class="empty-msg">Cargando documentos...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
            </section>

            <!-- Live Feed -->
            <section class="live-feed glass">
                <div class="section-header">
                    <h3>Actividad Reciente</h3>
                    <span class="live-tag">LIVE</span>
                </div>
                <div class="feed-table-container">
                    <table id="emails-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Remitente</th>
                                <th>Asunto</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="emails-body">
                            <tr>
                                <td colspan="4" class="empty-msg">Selecciona "Correos" para ver tu bandeja.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pagination Controls -->
                <div class="pagination-container"
                    style="display:flex; justify-content:center; gap:20px; margin-top:20px;">
                    <button id="prev-page" class="btn btn-secondary" onclick="changePage(-1)">Anterior</button>
                    <span id="page-info" style="align-self:center; color:var(--text-dim);">P√°gina 1</span>
                    <button id="next-page" class="btn btn-secondary" onclick="changePage(1)">Siguiente</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de Detalle de Correo -->
    <div id="email-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-subject">Asunto del Correo</h3>
                <p id="modal-sender" style="color: var(--text-dim); margin-top:5px; font-size:14px;"></p>
            </div>
            <div id="modal-body"
                style="margin-bottom: 25px; white-space: pre-wrap; font-size: 14px; line-height: 1.6; max-height: 400px; overflow-y: auto; background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; font-family: 'Inter', sans-serif; color: #e0e0e0; border: 1px solid rgba(255,255,255,0.05);">
            </div>

            <div style="border-top: 1px solid var(--glass-border); padding-top: 20px;">
                <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                    <h4 style="color: var(--accent-blue); margin: 0; font-size: 14px;">Idioma:</h4>
                    <select id="language-selector"
                        style="background: rgba(0,0,0,0.3); color: white; border: 1px solid var(--glass-border); border-radius: 6px; padding: 5px 10px; font-size: 13px;">
                        <option value="es">Espa√±ol</option>
                        <option value="en">Ingl√©s</option>
                        <option value="both">Ambos (ES + EN)</option>
                    </select>
                </div>

                <h4 style="color: var(--accent-blue); margin-bottom: 8px; font-size: 14px;">Instrucciones para la IA
                    (Prompt):</h4>
                <textarea id="custom-prompt" placeholder="Ej: Dile que s√≠ pero que solo puedo el martes..."
                    style="width:100%; height:60px; background: rgba(0,0,0,0.2); color: white; border: 1px solid var(--glass-border); border-radius: 8px; padding: 10px; margin-bottom: 15px; resize: none;"></textarea>

                <h4 style="color: var(--accent-purple); margin-bottom: 8px; font-size: 14px;">Respuesta sugerida:</h4>
                <div id="modal-ai-response"
                    style="background: rgba(157, 80, 187, 0.05); padding: 15px; border-radius: 10px; font-style: italic; min-height: 40px; white-space: pre-wrap; font-size: 14px;">
                </div>
            </div>

            <div class="modal-actions" style="flex-wrap: wrap; margin-top: 20px;">
                <button id="btn-generate" class="btn btn-primary" onclick="handleGenerateAI()">Generar con IA</button>
                <button id="btn-save-draft" class="btn btn-secondary" onclick="handleSaveDraft()"
                    style="background: var(--success); color: white; display: none;">Guardar en Borradores</button>
                <button class="btn btn-secondary" onclick="handleMarkRead()">Le√≠do</button>
                <button class="btn btn-danger" onclick="handleDelete()">Eliminar</button>
                <button class="btn btn-secondary" style="margin-left: auto;" onclick="closeModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Background Decoration -->
    <div class="bg-gradient-orb orb-1"></div>
    <div class="bg-gradient-orb orb-2"></div>

    <script src="/static/script.js"></script>
</body>

</html>